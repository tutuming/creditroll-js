// Generated by CoffeeScript 1.6.2
(function() {
  'use strict';
  var buildElem, creditRoll, loadYoutubeAPI;

  if (typeof creditRoll === "undefined" || creditRoll === null) {
    creditRoll = window.creditRoll = {};
  }

  buildElem = function(options) {
    var bh, creditDiv, elem;

    elem = $('<div class="__creditroll__">\n  <div class="scroller">\n  </div>\n</div>');
    $(options.staffs).each(function(i, staffPair) {
      var boxDiv, list, roll;

      roll = staffPair.roll;
      list = staffPair.list;
      boxDiv = $('<div class="box">\n  <div class="left">\n    <div class="inner rollText"></div>\n  </div>\n  <div class="right">\n    <div class="inner">\n      <ul class="list">\n      <ul>\n    </div>\n  </div>\n</div>');
      boxDiv.find('.rollText').text(roll);
      $(list).each(function(j, name) {
        var li;

        li = $('<li />');
        return li.text(name).appendTo(boxDiv.find('.list'));
      });
      return elem.find('.scroller').append(boxDiv);
    });
    if (options.credit != null) {
      creditDiv = $('<div class="credit">\n  <p></p>\n</div>');
      bh = $('body').outerHeight();
      creditDiv.css({
        height: bh,
        marginTop: bh
      });
      creditDiv.find('p').text(options.credit).css({
        lineHeight: bh + 'px'
      });
      elem.find('.scroller').append(creditDiv);
    }
    return elem;
  };

  loadYoutubeAPI = function(videoId, elem, complete) {
    var firstScriptTag, tag;

    window.onYouTubeIframeAPIReady = function() {
      var bh, bw, h, player, w;

      console.log('ytreadey');
      bw = $('body').outerWidth();
      bh = $('body').outerHeight();
      w = bw / 2 - 50;
      h = w * 390 / 640.0;
      $('#__creditrollVideo__').css({
        top: (bh - h) / 2
      });
      return player = new YT.Player('__creditrollVideo__', {
        height: h,
        width: w,
        videoId: videoId,
        playerVars: {
          autoplay: 1,
          rel: 0,
          controls: 0,
          showinfo: 0,
          disablekb: 1,
          iv_load_policy: 3,
          modestbranding: 1
        },
        events: {
          'onReady': function() {
            var dur;

            dur = player.getDuration();
            setTimeout(function() {
              return $('#__creditrollVideo__').animate({
                opacity: 0
              }, 1000);
            }, (dur - 1) * 1000);
            return complete(dur);
          }
        }
      });
    };
    tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    return elem.prepend('<div id="__creditrollVideo__"></div>');
  };

  creditRoll.start = function(options) {
    return $(function() {
      var bh, creditElem, doStart, hoffset, scroller, woffset;

      creditElem = buildElem(options);
      scroller = $(creditElem).find('.scroller');
      bh = $('body').outerHeight();
      scroller.css({
        paddingTop: bh
      });
      $('body').prepend(creditElem);
      hoffset = ($('body').outerHeight() - $('body').height()) / 2;
      woffset = ($('body').outerWidth() - $('body').width()) / 2;
      creditElem.css({
        top: -hoffset,
        right: -woffset
      });
      doStart = function(duration) {
        var creditHeight;

        console.log('doStart');
        creditHeight = scroller.outerHeight();
        return scroller.animate({
          top: -hoffset - creditHeight + $(window).height()
        }, duration * 1000, 'linear');
      };
      if (options.youtubeVideoId != null) {
        return loadYoutubeAPI(options.youtubeVideoId, creditElem, doStart);
      } else {
        return doStart(60);
      }
    });
  };

}).call(this);
